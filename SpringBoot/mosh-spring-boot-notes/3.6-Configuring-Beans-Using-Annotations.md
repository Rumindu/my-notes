# Configuring Beans Using Annotations

<!-- omit from toc -->
## Table of Contents

- [Two Ways to Configure Beans](#two-ways-to-configure-beans)
- [Using @Component Annotation](#using-component-annotation)
  - [Adding Component to OrderService](#adding-component-to-orderservice)
  - [Component Import and Package](#component-import-and-package)
- [Specialized Annotations](#specialized-annotations)
  - [Service vs Component](#service-vs-component)
  - [Other Specialized Annotations](#other-specialized-annotations)
  - [Service Annotation Implementation](#service-annotation-implementation)
- [Solving Dependency Issues](#solving-dependency-issues)
  - [PaymentService Interface Problem](#paymentservice-interface-problem)
  - [Annotating PayPal Payment Service](#annotating-paypal-payment-service)
  - [Why Not Annotate Both Services](#why-not-annotate-both-services)
- [Testing the Configuration](#testing-the-configuration)
- [Understanding @Autowired Annotation](#understanding-autowired-annotation)
  - [Modern Spring Behavior](#modern-spring-behavior)
  - [Single Constructor Rule](#single-constructor-rule)
  - [Legacy Code Considerations](#legacy-code-considerations)
- [Multiple Constructors and @Autowired](#multiple-constructors-and-autowired)
  - [Default Constructor Problem](#default-constructor-problem)
  - [Null Pointer Exception](#null-pointer-exception)
  - [Solution with @Autowired](#solution-with-autowired)
  - [Non-Default Constructor Issues](#non-default-constructor-issues)
  - [Bean Creation Exception](#bean-creation-exception)
- [Key Points](#key-points)
- [Links/References](#linksreferences)

## Two Ways to Configure Beans

- **Annotation-based**: Using annotations to mark classes (covered in this lesson)
- **Code-based**: Using Java configuration classes (covered later)
- **Goal**: Tell Spring which objects it should manage
- **Focus**: This lesson covers annotation approach

![Two Ways to Configure Spring Beans](assets/two-ways-configure-spring-beans.png)

## Using @Component Annotation

### Adding Component to OrderService

```java
@Component
public class OrderService {
    private PaymentService paymentService;
    
    public OrderService(PaymentService paymentService) {
        this.paymentService = paymentService;
    }
    
    public void placeOrder() {
        paymentService.processPayment(10.0);
    }
}
```

![Component Annotation on OrderService](assets/component-annotation-orderservice.png)

### Component Import and Package

- **Package**: `org.springframework.stereotype.Component`
- **Import process**: IntelliJ auto-imports when pressing Enter
- **Effect**: Tells Spring to manage objects of type OrderService
- **Auto-detection**: Spring will automatically create and manage OrderService beans

![Component Annotation Import](assets/component-annotation-import.png)

## Specialized Annotations

### Service vs Component

```java
@Service  // Specialized annotation for business logic
public class OrderService {
    // Business logic implementation
}
```

![Service Annotation on OrderService](assets/service-annotation-orderservice.png)

- **@Service**: Specialized annotation for classes containing business logic
- **Technical equivalence**: Service is just an alias for Component
- **No functional difference**: Both work exactly the same way
- **Semantic meaning**: Service provides better code documentation

### Other Specialized Annotations

- **@Repository**: For classes that interact with databases
- **@Controller**: For classes handling web requests (seen before)
- **@Service**: For classes containing business logic
- **@Component**: General-purpose annotation for utility classes

![Spring Stereotype Annotations](assets/spring-stereotype-annotations.png)

### Service Annotation Implementation

**Viewing the source:**
1. **Navigate**: Hold `Cmd` (Mac) or `Ctrl` (Windows) + click on `@Service`
2. **Observation**: Service annotation contains `@Component`
3. **Conclusion**: Service is an alias for Component

![Service Annotation Source Code](assets/service-annotation-source-code.png)

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component  // Service is just an alias for Component
public @interface Service {
    // Annotation definition
}
```

## Solving Dependency Issues

### PaymentService Interface Problem

**Error message**: "Could not autowire: no beans of PaymentService type found"

![Autowire Error PaymentService](assets/autowire-error-paymentservice.png)

**Root cause**: 
- OrderService needs PaymentService dependency
- PaymentService is an interface
- Spring doesn't know how to create instances of interfaces
- Need to annotate concrete implementations

### Annotating PayPal Payment Service

```java
@Service
public class PayPalPaymentService implements PaymentService {
    
    @Override
    public void processPayment(double amount) {
        System.out.println("PayPal");
        System.out.println(amount);
    }
}
```

![Service Annotation PayPal](assets/service-annotation-paypal.png)

### Why Not Annotate Both Services

- **Deliberate choice**: Not annotating StripePaymentService in this lesson
- **Future topic**: Will cause issues with multiple implementations (covered later)
- **Problem preview**: Spring won't know which implementation to choose
- **Current approach**: Only annotate PayPalPaymentService for now

![Single Implementation Strategy](assets/single-implementation-strategy.png)

## Testing the Configuration

**Expected output:**
```
PayPal
10.0
```

![Application Output with Annotations](assets/application-output-annotations.png)

**Success verification:**
- Application runs without exceptions
- PayPal payment service is automatically injected
- Spring manages object creation and dependency injection

## Understanding @Autowired Annotation

### Modern Spring Behavior

```java
@Service
public class OrderService {
    private PaymentService paymentService;
    
    // @Autowired not needed for single constructor
    public OrderService(PaymentService paymentService) {
        this.paymentService = paymentService;
    }
}
```

![Modern Constructor Injection](assets/modern-constructor-injection.png)

### Single Constructor Rule

- **Modern Spring**: @Autowired not necessary for single constructors
- **Automatic detection**: Spring automatically wires single constructor
- **Simplified code**: Less annotation clutter
- **Backward compatibility**: @Autowired still works if present

### Legacy Code Considerations

- **Older codebases**: May still have @Autowired on constructors
- **Still functional**: Code works with or without @Autowired
- **Migration**: Can safely remove @Autowired from single constructors

![Legacy Autowired Usage](assets/legacy-autowired-usage.png)

## Multiple Constructors and @Autowired

### Default Constructor Problem

```java
@Service
public class OrderService {
    private PaymentService paymentService;
    
    // Default constructor (commented out dependency injection constructor)
    public OrderService() {
        // paymentService remains null
    }
    
    // public OrderService(PaymentService paymentService) {
    //     this.paymentService = paymentService;
    // }
}
```

![Default Constructor Problem](assets/default-constructor-problem.png)

### Null Pointer Exception

**Runtime error**: NullPointerException when calling `paymentService.processPayment()`

![Null Pointer Exception Runtime](assets/null-pointer-exception-runtime.png)

**Root cause:**
- Spring uses default constructor (no arguments)
- PaymentService field remains uninitialized (null)
- Calling methods on null reference causes exception

### Solution with @Autowired

```java
@Service
public class OrderService {
    private PaymentService paymentService;
    
    public OrderService() {
        // Default constructor
    }
    
    @Autowired  // Required when multiple constructors exist
    public OrderService(PaymentService paymentService) {
        this.paymentService = paymentService;
    }
}
```

![Autowired with Multiple Constructors](assets/autowired-multiple-constructors.png)

### Non-Default Constructor Issues

```java
@Service
public class OrderService {
    private PaymentService paymentService;
    
    // No @Autowired with multiple constructors
    public OrderService(PaymentService paymentService) {
        this.paymentService = paymentService;
    }
    
    public OrderService(PaymentService paymentService, int x) {
        this.paymentService = paymentService;
        // Additional parameter
    }
}
```

![Multiple Constructors Without Autowired](assets/multiple-constructors-without-autowired.png)

**IDE warning**: "Class doesn't contain matching constructor for autowiring"

### Bean Creation Exception

**Error type**: `BeanCreationException`
**Error message**: "Error creating bean with name 'orderService'"

![Bean Creation Exception Error](assets/bean-creation-exception-error.png)

**Common occurrence**: Very common exception in Spring applications
**Solution**: Add @Autowired to specify which constructor to use

```java
@Autowired  // Tells Spring which constructor to use
public OrderService(PaymentService paymentService) {
    this.paymentService = paymentService;
}
```

![Bean Creation Exception Solution](assets/bean-creation-exception-solution.png)

## Key Points

- **Main takeaway**: Use annotations to tell Spring which classes to manage as beans
- **@Component vs @Service**: Service is specialized annotation for business logic, Component is general-purpose
- **Interface implementations**: Annotate concrete classes, not interfaces
- **@Autowired rules**: Not needed for single constructors in modern Spring, required for multiple constructors
- **Common exceptions**: BeanCreationException occurs when Spring can't determine which constructor to use
- **Best practice**: Use single constructor when possible to avoid @Autowired complexity
- **Annotation hierarchy**: @Service, @Repository, @Controller are all specialized versions of @Component
- **Dependency resolution**: Spring automatically injects dependencies when classes are properly annotated
- **Error troubleshooting**: "Could not autowire" errors usually mean missing annotations on dependency classes

## Links/References

- Video: 3.6-Configuring-Beans-Using-Annotations.mp4 (5m 1s)
- Previous: [The Spring IoC Container](3.5-The-Spring-IoC-Container.md)
- Next: Component Scanning

---

**Created**: July 30, 2025  
**Last Modified**: July 30, 2025
