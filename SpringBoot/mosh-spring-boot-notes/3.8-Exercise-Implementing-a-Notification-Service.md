# Exercise: Implementing a Notification Service

<!-- omit from toc -->
## Table of Contents

- [Exercise Overview](#exercise-overview)
- [System Requirements](#system-requirements)
- [UML Class Diagram Analysis](#uml-class-diagram-analysis)
  - [Understanding UML Notation](#understanding-uml-notation)
  - [NotificationService Interface](#notificationservice-interface)
  - [Implementation Classes](#implementation-classes)
  - [NotificationManager Class](#notificationmanager-class)
- [Implementation Solution](#implementation-solution)
  - [Creating NotificationService Interface](#creating-notificationservice-interface)
  - [Email Notification Implementation](#email-notification-implementation)
  - [SMS Notification Implementation](#sms-notification-implementation)
  - [NotificationManager Implementation](#notificationmanager-implementation)
  - [Final Keyword Benefits](#final-keyword-benefits)
  - [Main Application Setup](#main-application-setup)
- [Testing the Solution](#testing-the-solution)
- [Key Design Concepts](#key-design-concepts)
  - [Strategy Pattern Implementation](#strategy-pattern-implementation)
  - [Dependency Injection Benefits](#dependency-injection-benefits)
  - [Real-World Extensions](#real-world-extensions)
- [Key Points](#key-points)
- [Links/References](#linksreferences)

## Exercise Overview

- **Task**: Design a flexible notification system for an application
- **Channels**: Support multiple notification methods (Email, SMS)
- **Flexibility**: Allow swapping notification methods without changing core logic
- **Simulation**: Use print statements instead of real email/SMS sending
- **Spring Integration**: Use Spring IoC to wire up objects
- **Time estimate**: 10-15 minutes to implement

![Exercise Overview Diagram](assets/exercise-overview-notification-system.png)

## System Requirements

- **Multiple channels**: Email and SMS notification support
- **Flexible design**: Easy to add new notification types
- **Loose coupling**: Core application logic independent of notification method
- **Spring managed**: All components managed by Spring IoC container
- **Testable**: Simulate actual notifications with print statements

![Notification System Requirements](assets/notification-system-requirements.png)

## UML Class Diagram Analysis

### Understanding UML Notation

- **UML**: Unified Modeling Language for representing classes and relationships
- **Interface representation**: Boxes with interface stereotype
- **Implementation arrow**: Dashed arrow with triangle indicates interface implementation
- **Composition diamond**: Solid diamond shows "has-a" relationship

![UML Class Diagram Notification System](assets/uml-class-diagram-notification-system.png)

### NotificationService Interface

```java
public interface NotificationService {
    void send(String message);
}
```

- **Single method**: `send(String message)`
- **Contract definition**: Defines what all notification services must implement
- **Type**: Interface (not concrete class)

![NotificationService Interface Design](assets/notificationservice-interface-design.png)

### Implementation Classes

- **EmailNotificationService**: Implements NotificationService for email delivery
- **SMSNotificationService**: Implements NotificationService for SMS delivery
- **Dashed arrow with triangle**: UML notation for interface implementation
- **Multiple implementations**: Both classes implement same interface

![Notification Implementation Classes](assets/notification-implementation-classes.png)

### NotificationManager Class

- **Composition relationship**: Has-a NotificationService instance (diamond symbol)
- **Method**: `sendNotification(String message)`
- **Delegation**: Delegates actual sending to injected NotificationService
- **Flexibility**: Works with any NotificationService implementation

![NotificationManager Class Design](assets/notificationmanager-class-design.png)

## Implementation Solution

### Creating NotificationService Interface

```java
public interface NotificationService {
    void send(String message);
}
```

![NotificationService Interface Implementation](assets/notificationservice-interface-implementation.png)

**Interface characteristics:**
- **Single responsibility**: Only defines send capability
- **Simple contract**: One method with clear purpose
- **Implementation agnostic**: No knowledge of how sending is done

### Email Notification Implementation

```java
@Service("email")  // Assign bean name for @Qualifier usage
@Primary  // Mark as default implementation
public class EmailNotificationService implements NotificationService {
    
    @Override
    public void send(String message) {
        System.out.println("Sending email: " + message);
    }
}
```

![Email Notification Service Implementation](assets/email-notification-service-implementation.png)

**Key annotations:**
- **@Service("email")**: Registers bean with Spring and assigns name
- **@Primary**: Makes this the default choice when multiple implementations exist
- **Print statement**: Simulates email sending functionality

### SMS Notification Implementation

```java
@Service("sms")  // Assign bean name for @Qualifier usage
public class SMSNotificationService implements NotificationService {
    
    @Override
    public void send(String message) {
        System.out.println("Sending SMS: " + message);
    }
}
```

![SMS Notification Service Implementation](assets/sms-notification-service-implementation.png)

**Implementation notes:**
- **@Service("sms")**: Registers with Spring using "sms" name
- **No @Primary**: EmailNotificationService is the primary bean
- **Print simulation**: Uses console output to simulate SMS sending

### NotificationManager Implementation

```java
@Service
public class NotificationManager {
    private final NotificationService notificationService; // final for immutability
    
    public NotificationManager(NotificationService notificationService) {
        this.notificationService = notificationService;
    }
    
    public void sendNotification(String message) {
        // In real application: database access, message construction, etc.
        notificationService.send(message);
    }
}
```

![NotificationManager Implementation](assets/notificationmanager-implementation.png)

**Design features:**
- **@Service**: Managed by Spring IoC container
- **final field**: Immutable dependency (cannot be reassigned)
- **Constructor injection**: Dependency provided through constructor
- **Delegation pattern**: Delegates actual sending to injected service

### Final Keyword Benefits

```java
private final NotificationService notificationService;

// This would cause compile-time error due to final keyword:
// this.notificationService = new EmailNotificationService(); // Compile error!
```

![Final Keyword Benefits](assets/final-keyword-benefits.png)

**Protection provided:**
- **Immutability**: Prevents accidental reassignment
- **Compile-time safety**: Errors caught during compilation
- **Design enforcement**: Ensures dependency is set only once

### Main Application Setup

```java
@SpringBootApplication
public class StoreApplication {
    
    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(StoreApplication.class, args);
        
        NotificationManager manager = context.getBean(NotificationManager.class);
        manager.sendNotification("Welcome to our application!");
    }
}
```

![Main Application Setup](assets/main-application-setup-notification.png)

**Application flow:**
1. **Get bean**: Retrieve NotificationManager from Spring container
2. **Call method**: Invoke sendNotification with message
3. **Automatic injection**: Spring injects EmailNotificationService (primary bean)

## Testing the Solution

**Expected output:**
```
Sending email: Welcome to our application!
```

![Application Output Email Notification](assets/application-output-email-notification.png)

**Verification:**
- **Primary bean used**: EmailNotificationService is selected automatically
- **Dependency injection working**: NotificationManager receives proper dependency
- **Delegation successful**: Message properly passed to notification service

## Key Design Concepts

### Strategy Pattern Implementation
- **Multiple implementations**: Different strategies for sending notifications
- **Runtime selection**: Choose implementation based on configuration
- **Extensibility**: Easy to add new notification methods

### Dependency Injection Benefits
- **Loose coupling**: NotificationManager doesn't know specific implementation
- **Testability**: Easy to inject mock implementations for testing
- **Flexibility**: Change notification method without code changes

### Real-World Extensions
```java
public void sendNotification(String message) {
    // Real application might include:
    // 1. Fetch user preferences from database
    // 2. Format message based on notification type
    // 3. Log notification attempt
    // 4. Handle errors and retries
    
    notificationService.send(message);
}
```

![Real World Extension Possibilities](assets/real-world-extension-possibilities.png)

## Key Points

- **Main takeaway**: Implemented a flexible notification system using Spring IoC and dependency injection patterns
- **Design pattern**: Strategy pattern allows multiple notification implementations with runtime selection
- **Spring annotations**: @Service, @Primary, and constructor injection manage bean lifecycle and dependencies
- **UML understanding**: Class diagrams show relationships between interfaces, implementations, and composition
- **Immutability**: final keyword prevents accidental reassignment of critical dependencies
- **Extensibility**: Easy to add new notification types (WhatsApp, Slack) by implementing NotificationService
- **Testing advantage**: Simple to test by injecting mock implementations
- **Real-world application**: Pattern commonly used for payment processing, logging, file storage, etc.
- **Loose coupling**: NotificationManager works with any NotificationService implementation without modification

## Links/References

- Video: 3.8-Exercise-Implementing-a-Notification-Service.mp4 (4m 26s)
- Previous: [Controlling Bean Selection](3.7-Controlling-Bean-Selection.md)
- Next: Component Scanning

---

**Created**: July 30, 2025  
**Last Modified**: July 30, 2025
