# Defining Repositories

<!-- omit from toc -->

## Table of Contents

- [Table of Contents](#table-of-contents)
- [Repository Interface Hierarchy](#repository-interface-hierarchy)
- [Creating Repositories Manually](#creating-repositories-manually)
- [Keyboard Navigation Workflow](#keyboard-navigation-workflow)
- [Repository Interface Structure](#repository-interface-structure)
- [Creating Repositories with JPA Buddy](#creating-repositories-with-jpa-buddy)
- [Repository Selection Guidelines](#repository-selection-guidelines)
- [Key Points](#key-points)
- [Links/References](#linksreferences)

## Repository Interface Hierarchy

- **Repository interface**: Marker interface at the top of hierarchy - provides no methods
- **Foundation role**: Base interface for all other repository interfaces
- **CRUD Repository**: Provides basic CRUD (Create, Read, Update, Delete) functionality
- **Paging and Sorting Repository**: Extends Repository, adds sorting and paging methods
- **JPA Repository**: Extends both CRUD and Paging/Sorting repositories

![Spring Data JPA Repository Hierarchy](assets/spring-data-jpa-repository-hierarchy-diagram.png)

**Interface capabilities breakdown:**
- **CRUD Repository**: Methods for saving, finding, deleting, and counting records
- **Paging and Sorting Repository**: Data pagination and sorting capabilities
- **JPA Repository**: Advanced features like flushing changes, batch deleting, advanced querying

**Common usage patterns:**
- **CRUD Repository**: Basic database operations
- **JPA Repository**: Advanced querying and batch operations
- **Most practical choice**: These two interfaces cover majority of use cases

## Creating Repositories Manually

- **Package organization**: Create dedicated repositories package for all repository interfaces
- **Naming convention**: Use "Repository" suffix in interface names (e.g., UserRepository)
- **Interface extension**: Extend appropriate repository interface based on needs
- **Generic parameters**: Specify entity type and primary key type

```java
package com.store.repositories;

import com.store.entities.User;
import org.springframework.data.repository.CrudRepository;

public interface UserRepository extends CrudRepository<User, Long> {
    // Custom query methods can be added here
}
```

![User Repository Interface Creation](assets/user-repository-interface-creation.png)

**Generic type parameters explained:**
- **First parameter**: Entity class for which repository is created (User)
- **Second parameter**: Type of primary key in entity (Long)
- **Type safety**: Ensures compile-time checking for repository operations

## Keyboard Navigation Workflow

- **Project view access**: Command+1 (Mac) or Ctrl+1 (Windows) to open/close project view
- **Navigation**: Use up/down arrows to select different items in project tree
- **Context menu**: Command+N (Mac) or Ctrl+N (Windows) to open generate menu
- **Package creation**: Select "Package" from generate menu, type package name
- **Interface creation**: Select "Java Class", specify name, choose "Interface" type

![IntelliJ Keyboard Navigation Workflow](assets/intellij-keyboard-navigation-workflow.png)

**Complete keyboard workflow steps:**
1. Open project view with keyboard shortcut
2. Navigate to desired package using arrow keys
3. Generate new package using context menu
4. Create new interface in package
5. Close project view when done

**Auto-completion assistance:**
- **IntelliJ suggestions**: IDE suggests extending CrudRepository automatically
- **Import resolution**: Alt+Enter to import required classes
- **Entity selection**: Choose entity class from entities package

![IntelliJ Auto-Completion Repository Creation](assets/intellij-auto-completion-repository-creation.png)

## Repository Interface Structure

- **Extension requirement**: Repository interfaces must extend Spring Data repository interface
- **Generic specification**: Provide entity type and primary key type as generic parameters
- **Import statements**: Import entity classes and repository interfaces
- **Method inheritance**: Inherit all CRUD methods from parent repository interface

```java
public interface UserRepository extends CrudRepository<User, Long> {
    // Inherited methods include:
    // save(User entity)
    // findById(Long id)
    // findAll()
    // deleteById(Long id)
    // count()
    // existsById(Long id)
}
```

![Repository Interface Generic Parameters](assets/repository-interface-generic-parameters.png)

**Inherited functionality from CrudRepository:**
- **Save operations**: save(), saveAll() methods for persisting entities
- **Find operations**: findById(), findAll() methods for retrieving data
- **Delete operations**: deleteById(), delete(), deleteAll() methods
- **Utility methods**: count(), existsById() for data verification

## Creating Repositories with JPA Buddy

- **JPA Buddy requirement**: Plugin must be installed in IntelliJ for this feature
- **Enhanced generation**: Provides Spring Data JPA repository option in generate menu
- **Entity selection**: Choose target entity from dropdown list
- **Parent interface**: Select from available repository interfaces (CRUD, JPA, etc.)
- **Automated creation**: Generates complete repository interface with proper generics

![JPA Buddy Repository Generation Dialog](assets/jpa-buddy-repository-generation-dialog.png)

**JPA Buddy workflow:**
1. Select repositories package in project view
2. Open generate context menu (Command+N/Ctrl+N)
3. Choose "Spring Data JPA Repository" option
4. Select target entity (e.g., Address)
5. Choose parent repository interface
6. Generate complete repository interface

```java
// Generated by JPA Buddy
public interface AddressRepository extends CrudRepository<Address, Long> {
    // Ready to use for database operations
}
```

![JPA Buddy Generated Repository Code](assets/jpa-buddy-generated-repository-code.png)

**Available parent interfaces in JPA Buddy:**
- **CrudRepository**: Basic CRUD operations
- **PagingAndSortingRepository**: Sorting and pagination support
- **JpaRepository**: Advanced JPA features
- **Repository**: Base marker interface
- **Custom interfaces**: Additional specialized repository types

## Repository Selection Guidelines

- **CrudRepository choice**: Select for basic database operations (save, find, delete, count)
- **JpaRepository choice**: Choose for advanced querying, batch operations, flushing changes
- **Practical recommendation**: Start with CrudRepository, upgrade to JpaRepository when needed
- **Feature comparison**: JpaRepository includes all CrudRepository methods plus additional functionality

![Repository Interface Selection Guide](assets/repository-interface-selection-guide.png)

**Decision factors:**
- **Basic operations only**: Use CrudRepository for simple CRUD needs
- **Advanced features needed**: Use JpaRepository for complex queries and batch operations
- **Performance considerations**: JpaRepository provides flush() method for immediate persistence
- **Future extensibility**: JpaRepository offers more flexibility for growing application needs

**Common repository patterns:**
```java
// For basic operations
public interface UserRepository extends CrudRepository<User, Long> {
}

// For advanced operations
public interface ProductRepository extends JpaRepository<Product, Long> {
    // Can add custom query methods
    List<Product> findByCategory(String category);
}
```

![Repository Pattern Examples](assets/repository-pattern-examples.png)

## Key Points

- **Main takeaway**: Spring Data JPA provides hierarchy of repository interfaces with Repository as marker interface, CrudRepository for basic operations, and JpaRepository for advanced features
- **Interface selection**: Choose CrudRepository for basic CRUD operations, JpaRepository for advanced querying and batch operations
- **Generic parameters**: Repository interfaces require entity type and primary key type as generic parameters for type safety
- **Naming convention**: Follow standard naming with "Repository" suffix for all repository interfaces
- **Package organization**: Create dedicated repositories package to organize all repository interfaces
- **Creation methods**: Can create repositories manually or use JPA Buddy plugin for automated generation
- **Keyboard efficiency**: IntelliJ provides complete keyboard navigation workflow for creating repositories without mouse usage
- **Inheritance benefits**: Repository interfaces automatically inherit all parent interface methods for immediate database operations
- **Auto-completion**: IntelliJ provides intelligent suggestions for repository creation and class imports
- **Practical usage**: Most applications use either CrudRepository or JpaRepository depending on complexity requirements

## Links/References

- Video: 4.8.1-Defining-Repositories.mp4 (04:35)
- Previous: [Creating Repositories](4.8.0-Creating-Repositories.md)
- Next: Repository Methods and Queries
- Reference: [Spring Data JPA Repository Interfaces](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.core-concepts)
- Reference: [CrudRepository Documentation](https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html)

---

**Created**: July 31, 2025  
**Last Modified**: July 31, 2025
