# Externalizing Configuration

<!-- omit from toc -->
## Table of Contents

- [Why Externalize Configuration](#why-externalize-configuration)
- [Using Application Properties](#using-application-properties)
  - [Adding Configuration Properties](#adding-configuration-properties)
  - [Reading Properties with @Value](#reading-properties-with-value)
  - [Property Types and Examples](#property-types-and-examples)
  - [Default Values](#default-values)
  - [Testing Configuration Injection](#testing-configuration-injection)
- [YAML Configuration Format](#yaml-configuration-format)
  - [Introduction to YAML](#introduction-to-yaml)
  - [Converting Properties to YAML](#converting-properties-to-yaml)
  - [YAML Hierarchical Structure](#yaml-hierarchical-structure)
  - [YAML vs Properties Comparison](#yaml-vs-properties-comparison)
  - [File Precedence and Management](#file-precedence-and-management)
- [Testing the YAML Configuration](#testing-the-yaml-configuration)
- [Key Points](#key-points)
- [Links/References](#linksreferences)

## Why Externalize Configuration

- **Common application needs**: Database URLs, API keys, application settings
- **Bad practice**: Hard-coding configuration values in source code
- **Best practice**: Store configuration in external files
- **Benefits**: Environment-specific configurations, easier maintenance, security

![Configuration Externalization Benefits](assets/configuration-externalization-benefits.png)

**Real-world example**: StripePaymentService needs API URL, API key, timeout settings

## Using Application Properties

### Adding Configuration Properties

```properties
# Stripe Payment Service Configuration
stripe.api-url=https://api.stripe.com
stripe.enabled=true
stripe.timeout=1000
stripe.supported-currencies=USD,EUR,GBP
```

![Application Properties Configuration](assets/application-properties-configuration-stripe.png)

**Configuration file**: `src/main/resources/application.properties`

### Reading Properties with @Value

```java
@Service("stripe")
@Primary
public class StripePaymentService implements PaymentService {
    
    @Value("${stripe.api-url}")
    private String apiUrl;
    
    @Override
    public void processPayment(double amount) {
        System.out.println("Stripe");
        System.out.println(amount);
    }
}
```

![Value Annotation Property Injection](assets/value-annotation-property-injection.png)

**@Value syntax:**
- **Dollar sign**: `${}` required for property injection
- **Property name**: Exact key from application.properties
- **IntelliJ assistance**: `Ctrl+Space` shows available properties

![IntelliJ Property Autocomplete](assets/intellij-property-autocomplete.png)

### Property Types and Examples

```java
@Service("stripe")
@Primary
public class StripePaymentService implements PaymentService {
    
    @Value("${stripe.api-url}")
    private String apiUrl;
    
    @Value("${stripe.enabled}")
    private boolean enabled;
    
    @Value("${stripe.timeout}")
    private int timeout;
    
    @Value("${stripe.supported-currencies}")
    private List<String> supportedCurrencies;
}
```

![Multiple Property Types Example](assets/multiple-property-types-example.png)

**Supported types:**
- **String**: Text values
- **Boolean**: true/false values
- **Numbers**: int, long, double, etc.
- **Lists**: Comma-separated values automatically converted to List<String>

### Default Values

```java
@Value("${stripe.timeout:3000}")  // Default value of 3000 if property not found
private int timeout;
```

![Default Values Configuration](assets/default-values-configuration.png)

**Default value syntax:**
- **Colon separator**: `:` separates property name from default value
- **Fallback behavior**: Uses default if property not defined
- **Override capability**: Property value overrides default when present

### Testing Configuration Injection

```java
@Service("stripe")
@Primary
public class StripePaymentService implements PaymentService {
    
    @Value("${stripe.api-url}")
    private String apiUrl;
    
    @Value("${stripe.enabled}")
    private boolean enabled;
    
    @Value("${stripe.timeout:3000}")
    private int timeout;
    
    @Value("${stripe.supported-currencies}")
    private List<String> supportedCurrencies;
    
    @Override
    public void processPayment(double amount) {
        System.out.println("API URL: " + apiUrl);
        System.out.println("Enabled: " + enabled);
        System.out.println("Timeout: " + timeout);
        System.out.println("Currencies: " + supportedCurrencies);
        
        System.out.println("Stripe");
        System.out.println(amount);
    }
}
```

![Configuration Testing Implementation](assets/configuration-testing-implementation.png)

**Updated main application:**
```java
@SpringBootApplication
public class StoreApplication {
    
    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(StoreApplication.class, args);
        
        OrderService orderService = context.getBean(OrderService.class);
        orderService.placeOrder();
    }
}
```

![Updated Main Application Configuration](assets/updated-main-application-configuration.png)

**Expected output:**
```
API URL: https://api.stripe.com
Enabled: true
Timeout: 1000
Currencies: [USD, EUR, GBP]
Stripe
10.0
```

![Configuration Values Output](assets/configuration-values-output.png)

## YAML Configuration Format

### Introduction to YAML

- **YAML**: Yet Another Markup Language
- **Format**: More structured and readable than properties
- **Use case**: Especially good for hierarchical data
- **Popularity**: Preferred by many developers for configuration

![YAML Format Introduction](assets/yaml-format-introduction.png)

### Converting Properties to YAML

**Create new file**: `src/main/resources/application.yaml`

![Creating Application YAML File](assets/creating-application-yaml-file.png)

**Properties format (original):**
```properties
spring.application.name=store
stripe.api-url=https://api.stripe.com
stripe.enabled=true
stripe.timeout=1000
stripe.supported-currencies=USD,EUR,GBP
```

**YAML format (converted):**
```yaml
spring:
  application:
    name: store

stripe:
  api-url: https://api.stripe.com
  enabled: true
  timeout: 1000
  supported-currencies: USD,EUR,GBP
```

![Properties to YAML Conversion](assets/properties-to-yaml-conversion.png)

### YAML Hierarchical Structure

**YAML syntax:**
- **Key-value pairs**: `key: value` (colon followed by space)
- **Hierarchy**: Indentation defines structure
- **No duplication**: Common prefixes grouped together

![YAML Hierarchical Structure](assets/yaml-hierarchical-structure.png)

**Hierarchy example:**
```yaml
stripe:
  api-url: https://api.stripe.com
  timeout: 1000
  enabled: true
  supported-currencies: USD,EUR,GBP
```

### YAML vs Properties Comparison

**Problems with properties:**
- **Key duplication**: `stripe.` prefix repeated multiple times
- **Flat structure**: No visual hierarchy
- **Messy appearance**: Becomes cluttered as application grows

**YAML advantages:**
- **Clean structure**: Hierarchical organization
- **No duplication**: Common prefixes grouped
- **Better readability**: Visual hierarchy makes relationships clear

![YAML vs Properties Comparison](assets/yaml-vs-properties-comparison.png)

### File Precedence and Management

**File precedence rules:**
- **Both files present**: YAML takes precedence over properties
- **Best practice**: Use only one format to avoid confusion
- **Recommendation**: Delete application.properties when using YAML

![File Precedence Rules](assets/file-precedence-rules.png)

**Cleanup step**: Remove application.properties to avoid maintaining two configuration files

![Deleting Properties File](assets/deleting-properties-file.png)

## Testing the YAML Configuration

**Verification run**: Ensure application works with YAML configuration

**Expected output (same as before):**
```
API URL: https://api.stripe.com
Enabled: true
Timeout: 1000
Currencies: [USD, EUR, GBP]
Stripe
10.0
```

![YAML Configuration Test Output](assets/yaml-configuration-test-output.png)

**Success confirmation**: Application works exactly the same with YAML format

## Key Points

- **Main takeaway**: Externalize configuration using application.properties or application.yaml to avoid hard-coding values in source code
- **@Value annotation**: Inject configuration values into Spring beans using `@Value("${property.key}")` syntax
- **Property types**: Support for String, boolean, numbers, and lists with automatic type conversion
- **Default values**: Use `@Value("${property.key:defaultValue}")` syntax for fallback values
- **YAML advantages**: More readable and structured format, especially for hierarchical configuration
- **File precedence**: YAML takes precedence over properties when both files exist
- **Best practice**: Use single configuration format (properties OR YAML) to avoid confusion
- **IntelliJ support**: IDE provides autocomplete for property names and automatic type conversion
- **Environment flexibility**: Easy to change configurations for different environments without code changes

## Links/References

- Video: 3.9-Externalizing-Configuration.mp4 (7m 30s)
- Previous: [Exercise: Implementing a Notification Service](3.8-Exercise-Implementing-a-Notification-Service.md)
- Next: Component Scanning

---

**Created**: July 30, 2025  
**Last Modified**: July 30, 2025
