# Bean Scopes

<!-- omit from toc -->
## Table of Contents

- [Understanding Bean Creation in Spring](#understanding-bean-creation-in-spring)
- [What are Bean Scopes](#what-are-bean-scopes)
- [Singleton Scope (Default)](#singleton-scope-default)
  - [Testing Singleton Behavior](#testing-singleton-behavior)
  - [When to Use Singleton](#when-to-use-singleton)
- [Prototype Scope](#prototype-scope)
  - [Configuring Prototype Scope](#configuring-prototype-scope)
  - [Alternative Configuration with Annotations](#alternative-configuration-with-annotations)
  - [Testing Prototype Behavior](#testing-prototype-behavior)
  - [When to Use Prototype](#when-to-use-prototype)
- [Web-Specific Scopes](#web-specific-scopes)
  - [Request Scope](#request-scope)
  - [Session Scope](#session-scope)
- [Key Points](#key-points)
- [Links/References](#linksreferences)

## Understanding Bean Creation in Spring

- **Bean storage**: Spring creates beans and stores them in ApplicationContext (IoC container)
- **Key question**: Are beans created once and reused, or created every time they're needed?
- **Answer**: Depends on the bean scope
- **Scope definition**: Determines how and when beans are created and how long they live

![Bean Creation in Spring Container](assets/bean-creation-spring-container.png)

## What are Bean Scopes

- **Purpose**: Controls bean lifecycle and instance management
- **Scope types**: Different scopes for different use cases
- **Default behavior**: Singleton scope (one instance per container)
- **Configuration**: Can be changed using @Scope annotation

![Bean Scopes Overview](assets/bean-scopes-overview.png)

## Singleton Scope (Default)

- **Behavior**: Only one instance of the bean is created per container
- **Default scope**: Used automatically unless specified otherwise
- **Instance reuse**: Same instance returned for all requests
- **Memory efficient**: Single instance shared across application

![Singleton Scope Concept](assets/singleton-scope-concept.png)

### Testing Singleton Behavior

```java
@SpringBootApplication
public class StoreApplication {
    
    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(StoreApplication.class, args);
        
        OrderService orderService = context.getBean(OrderService.class);
        OrderService orderService2 = context.getBean(OrderService.class);
        
        System.out.println("OrderService 1: " + orderService);
        System.out.println("OrderService 2: " + orderService2);
        System.out.println("Same instance: " + (orderService == orderService2));
    }
}
```

![Testing Singleton Scope](assets/testing-singleton-scope.png)

**Expected output:**
```
OrderService created
OrderService 1: com.example.OrderService@12345678
OrderService 2: com.example.OrderService@12345678
Same instance: true
```

![Singleton Scope Test Output](assets/singleton-scope-test-output.png)

**Observation**: Single instance created and reused for both requests

### When to Use Singleton

- **Stateless components**: Services that don't hold user-specific data
- **Reusable components**: Objects that can be safely shared
- **Performance**: Reduces memory usage and object creation overhead
- **Examples**: Service classes, repositories, configuration objects

![When to Use Singleton Scope](assets/when-to-use-singleton-scope.png)

## Prototype Scope

- **Behavior**: New instance created every time bean is requested from IoC container
- **Fresh instances**: Each request gets a completely new object
- **Use case**: Components that hold state or are used temporarily
- **Memory consideration**: More memory usage due to multiple instances

![Prototype Scope Concept](assets/prototype-scope-concept.png)

### Configuring Prototype Scope

**Using AppConfig class:**
```java
@Configuration
public class AppConfig {
    
    @Bean
    @Scope("prototype")  // Change scope from default singleton
    public OrderService orderService() {
        if (paymentGateway.equals("stripe")) {
            return new OrderService(stripe());
        } else {
            return new OrderService(payPal());
        }
    }
}
```

![Configuring Prototype Scope in AppConfig](assets/configuring-prototype-scope-appconfig.png)

**Scope options available:**
- `prototype`
- `singleton` (default)
- `request`
- `session`

![Scope Options Available](assets/scope-options-available.png)

### Alternative Configuration with Annotations

**Using annotations directly on class:**
```java
@Service
@Scope("prototype")  // Apply to class when using annotation-based configuration
public class OrderService {
    private PaymentService paymentService;
    
    public OrderService(PaymentService paymentService) {
        System.out.println("OrderService created");
        this.paymentService = paymentService;
    }
    
    public void placeOrder() {
        paymentService.processPayment(10.0);
    }
}
```

![Prototype Scope with Annotations](assets/prototype-scope-with-annotations.png)

**Note**: Apply @Scope annotation to the class itself when using annotation-based configuration

### Testing Prototype Behavior

**Same test code as singleton:**
```java
OrderService orderService = context.getBean(OrderService.class);
OrderService orderService2 = context.getBean(OrderService.class);
```

**Expected output:**
```
OrderService created
OrderService created
OrderService 1: com.example.OrderService@12345678
OrderService 2: com.example.OrderService@87654321
Same instance: false
```

![Prototype Scope Test Output](assets/prototype-scope-test-output.png)

**Observation**: Two separate instances created for each request

### When to Use Prototype

- **Stateful components**: Objects that maintain user-specific or request-specific state
- **Temporary usage**: Objects used for short-term operations
- **Thread safety**: When singleton would cause thread safety issues
- **Examples**: DTOs with user data, temporary calculation objects

![When to Use Prototype Scope](assets/when-to-use-prototype-scope.png)

## Web-Specific Scopes

### Request Scope

- **Lifecycle**: New bean instance created for each HTTP request
- **Duration**: Bean exists only for the duration of the HTTP request
- **Cleanup**: Destroyed once the request is completed
- **Use case**: Storing request-specific data in web applications

![Request Scope Concept](assets/request-scope-concept.png)

**Configuration example:**
```java
@Service
@Scope("request")
public class RequestScopedService {
    // Bean created per HTTP request
}
```

**Use cases:**
- Request-specific user data
- Temporary processing data for web requests
- Request tracking and logging

### Session Scope

- **Lifecycle**: New bean instance created for each HTTP session
- **Duration**: Bean exists for the duration of the user session
- **Cleanup**: Destroyed when the session ends or times out
- **Use case**: Storing user session data

![Session Scope Concept](assets/session-scope-concept.png)

**Configuration example:**
```java
@Service
@Scope("session")
public class SessionScopedService {
    // Bean created per HTTP session
}
```

**Use cases:**
- User authentication data
- Shopping cart contents
- User preferences during session
- Session-specific configuration

![Web Scopes Use Cases](assets/web-scopes-use-cases.png)

## Key Points

- **Main takeaway**: Bean scopes control how and when Spring creates and manages bean instances
- **Default scope**: Singleton - one instance per container, suitable for stateless components
- **Prototype scope**: New instance per request, useful for stateful or temporary components
- **Configuration methods**: Use @Scope annotation on classes or @Bean methods
- **Web scopes**: Request and session scopes designed for web applications
- **Performance consideration**: Singleton is more memory efficient, prototype offers more isolation
- **Use case decision**: Choose singleton for stateless services, prototype for stateful components
- **Web applications**: Request scope for per-request data, session scope for per-user data
- **Testing approach**: Use multiple getBean() calls to verify scope behavior

## Links/References

- Video: 3.12-Bean-Scopes.mp4 (2m 30s)
- Previous: [Lazy Initialization](3.11-Lazy-Initialization.md)
- Next: Bean Lifecycle

---

**Created**: July 30, 2025  
**Last Modified**: July 30, 2025
